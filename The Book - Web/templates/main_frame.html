<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghostless Shell: {% block title %}Home{% endblock %}</title>
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <!-- TODO Add metatags -->


    <!-- Logic -->
    <script></script>
    <script type="module" src="{{ url_for('static', filename='js/common/firebase.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/common/login.js') }}"></script>
    
    <!-- Styling -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style/main_frame.css') }}">

    <!-- Templates -->
    {% block headers %} {% endblock %}
</head>
<body>
    <header>
        <nav class="nav-drawer">
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/the_book">The Book</a></li>

                <li class="admin-only hidden"><a href="/persona/cassandra/">Persona (Cassandra)</a></li>
                <li class="admin-only hidden"><a href="/chat_gpteam">ChatGPTeam</a></li>
                <li class="admin-only hidden"><a href="/admin/data/clean">Clean up firestore</a></li>
                <li class="admin-only hidden"><a href="/admin/data/populate_world">Populate world</a></li>
                <ul>
                    <li>
                        <form id="logout-form" style="display:none;">
                            <label id="logout-form-user-email"></label>
                            <button type="submit">Log out</button>
                        </form>
                    </li>
                </ul>
            </ul>
        </nav>
        <button class="toggle-button"><i class="fas fa-chevron-up"></i></button>
    </header>
    <main>
        {% block content %}

        {% endblock %}
    </main>
    <footer>
        <button class="toggle-button"><i class="fas fa-chevron-down"></i></button>
        <div class="footer-drawer">
            <ul>
                <li><a href="/contact">Contact</a></li>
                <li><a href="https://www.buymeacoffee.com/myl1ne">Buy me a coffee</a></li>
            </ul>
        </div>
    </footer>

    <script>
        function headerFooterClose() {
            document.querySelector('body').className = 'collapsed-both';
            let nav = document.querySelector('.nav-drawer');
            nav.style.display = 'none';
            nav.parentElement.classList.add('collapsed');
            let foot = document.querySelector('.footer-drawer');
            foot.style.display = 'none';
            foot.parentElement.classList.add('collapsed');
            const toggleButtons = document.querySelectorAll('.toggle-button');
            toggleButtons.forEach((btn) => {
                if (btn.parentElement.tagName === 'HEADER') {
                    btn.querySelector('i').className = 'fas fa-chevron-down';
                } else if (btn.parentElement.tagName === 'FOOTER') {
                    btn.querySelector('i').className = 'fas fa-chevron-up';
                }
            });
        }

        function headerFooterOpen() {
            document.querySelector('body').className = '';
            let nav = document.querySelector('.nav-drawer');
            nav.style.display = 'flex';
            nav.parentElement.classList.remove('collapsed');
            let foot = document.querySelector('.footer-drawer');
            foot.style.display = 'flex';
            foot.parentElement.classList.remove('collapsed');
            const toggleButtons = document.querySelectorAll('.toggle-button');
            toggleButtons.forEach((btn) => {
                if (btn.parentElement.tagName === 'HEADER') {
                    btn.querySelector('i').className = 'fas fa-chevron-up';
                } else if (btn.parentElement.tagName === 'FOOTER') {
                    btn.querySelector('i').className = 'fas fa-chevron-down';
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            const toggleButtons = document.querySelectorAll('.toggle-button');
            let collapsedHeader = false;
            let collapsedFooter = false;

            toggleButtons.forEach((btn) => {
                btn.addEventListener('click', function() {
                    const parent = btn.parentElement;
                    const drawer = parent.querySelector('.nav-drawer, .footer-drawer');
                    const icon = btn.querySelector('i');
                    const isCollapsed = parent.classList.toggle('collapsed');
                    drawer.style.display = drawer.style.display === 'none' ? 'flex' : 'none';

                    if (parent.tagName === 'HEADER') {
                        collapsedHeader = isCollapsed;
                        icon.className = isCollapsed ? 'fas fa-chevron-down' : 'fas fa-chevron-up';
                    } else if (parent.tagName === 'FOOTER') {
                        collapsedFooter = isCollapsed;
                        icon.className = isCollapsed ? 'fas fa-chevron-up' : 'fas fa-chevron-down';
                    }

                    if (collapsedHeader && collapsedFooter) {
                        headerFooterClose();
                    } else if (collapsedHeader) {
                        document.querySelector('body').className = 'collapsed-header';
                    } else if (collapsedFooter) {
                        document.querySelector('body').className = 'collapsed-footer';
                    } else {
                        headerFooterOpen();
                    }
                });
            });
        });
    </script>
</body>
</html>